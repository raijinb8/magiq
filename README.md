# MagIQ

å»ºè¨­æ¥­å‘ã‘ã®ä½œæ¥­æŒ‡ç¤ºæ›¸ç®¡ç†ã¨ã‚·ãƒ•ãƒˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã®ãŸã‚ã®ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚AI ã‚’æ´»ç”¨ã—ãŸ PDF å‡¦ç†ã«ã‚ˆã‚Šã€ä½œæ¥­æŒ‡ç¤ºæ›¸ã‹ã‚‰å¿…è¦ãªæƒ…å ±ã‚’è‡ªå‹•æŠ½å‡ºã—ã€æ¥­å‹™åŠ¹ç‡ã‚’å¤§å¹…ã«æ”¹å–„ã—ã¾ã™ã€‚

## ä¸»ãªæ©Ÿèƒ½

### ğŸ—‚ï¸ PDF ä½œæ¥­æŒ‡ç¤ºæ›¸ç®¡ç†
- ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã«ã‚ˆã‚‹ç°¡å˜ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ PDFãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
- ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®å¯è¦–åŒ–

### ğŸ¤– AI ã«ã‚ˆã‚‹æƒ…å ±æŠ½å‡º
- Google Gemini AI ã‚’æ´»ç”¨ã—ãŸé«˜ç²¾åº¦ãªãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
- ä¼æ¥­ãƒ»å¸³ç¥¨ç¨®åˆ¥ã«å¿œã˜ãŸã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
- æŠ½å‡ºçµæœã®ç¢ºèªãƒ»ç·¨é›†æ©Ÿèƒ½

### ğŸ“… ã‚·ãƒ•ãƒˆç®¡ç†
- ç›´æ„Ÿçš„ãªã‚·ãƒ•ãƒˆå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
- æ¬¡å›ã‚·ãƒ•ãƒˆã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º
- ã‚·ãƒ•ãƒˆæå‡ºçŠ¶æ³ã®ä¸€å…ƒç®¡ç†

### ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒ»ç®¡ç†
- Supabase Auth ã«ã‚ˆã‚‹å®‰å…¨ãªèªè¨¼
- ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- ç®¡ç†è€…å‘ã‘å°‚ç”¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

### ğŸ¢ ãƒãƒ«ãƒã‚«ãƒ³ãƒ‘ãƒ‹ãƒ¼å¯¾å¿œ
- ä¼æ¥­ã”ã¨ã®å‹•çš„è¨­å®š
- ä¼šç¤¾å›ºæœ‰ã®PDFå‡¦ç†ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
- ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãª UI/UX

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **React 19** + **TypeScript**
- **Vite 6.2** (@tailwindcss/vite plugin)
- **Tailwind CSS v4** (æœ€æ–°ç‰ˆ)
- **React Router v7**
- **Zustand** (çŠ¶æ…‹ç®¡ç†)
- **react-pdf** (PDFãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°)
- **shadcn/ui** (UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)
- **Sonner** (é€šçŸ¥ãƒˆãƒ¼ã‚¹ãƒˆ)

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **Supabase**
  - PostgreSQL 15
  - èªè¨¼ (Supabase Auth)
  - ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ (Supabase Storage)
  - Edge Functions (Deno v1 ãƒ©ãƒ³ã‚¿ã‚¤ãƒ )
- **Google Gemini AI API**
  - `gemini-2.5-flash-preview-04-17` ãƒ¢ãƒ‡ãƒ«
  - PDFå‡¦ç†ã¨ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º

### é–‹ç™ºç’°å¢ƒ
- **Docker** & **Docker Compose**
- **VS Code Dev Containers**
- **Supabase CLI**

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### å‰ææ¡ä»¶

- Docker Desktop
- Node.js 18+ (LTSæ¨å¥¨)
- Supabase CLI
- Google Gemini API ã‚­ãƒ¼

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

1. **ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³**
   ```bash
   git clone <repository-url>
   cd magiq
   ```

2. **ç’°å¢ƒå¤‰æ•°ã®è¨­å®š**

   ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç”¨ (`frontend/.env`):
   ```env
   VITE_PUBLIC_SUPABASE_URL=http://localhost:54321
   VITE_PUBLIC_SUPABASE_ANON_KEY=<supabase startã§è¡¨ç¤ºã•ã‚Œã‚‹å€¤>
   ```

   ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç”¨ (`supabase/functions/process-pdf-single/.env`):
   ```env
   GEMINI_API_KEY=<ã‚ãªãŸã®Gemini APIã‚­ãƒ¼>
   ```

3. **Supabaseèµ·å‹•ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**
   ```bash
   supabase start
   supabase db reset
   ```

4. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èµ·å‹•**
   ```bash
   cd frontend
   npm install
   npm run dev
   ```

5. **ã‚¢ã‚¯ã‚»ã‚¹**
   - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³: http://localhost:5173
   - Supabase Studio: http://localhost:54323

## é–‹ç™ºã‚³ãƒãƒ³ãƒ‰

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
```bash
cd frontend
npm run dev        # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆãƒãƒ¼ãƒˆ5173ï¼‰
npm run build      # TypeScriptãƒã‚§ãƒƒã‚¯ + æœ¬ç•ªãƒ“ãƒ«ãƒ‰
npm run lint       # ESLintå®Ÿè¡Œ
npm run preview    # æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
```

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
```bash
supabase start     # ãƒ­ãƒ¼ã‚«ãƒ«Supabaseèµ·å‹•
supabase db reset  # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚»ãƒƒãƒˆ
supabase functions serve process-pdf-single --env-file supabase/functions/process-pdf-single/.env
```

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
.
â”œâ”€â”€ frontend/                 # React ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/      # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ pages/          # ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ  
â”‚   â”‚   â”œâ”€â”€ hooks/          # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ lib/            # APIãƒ»Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ store/          # ZustandçŠ¶æ…‹ç®¡ç†
â”‚   â”‚   â””â”€â”€ types/          # TypeScriptå‹å®šç¾©
â”‚   â””â”€â”€ public/
â”‚       â””â”€â”€ config/         # ä¼æ¥­åˆ¥è¨­å®š
â”œâ”€â”€ supabase/                # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ functions/          # Edge Functions
â”‚   â”‚   â””â”€â”€ process-pdf-single/
â”‚   â”‚       â””â”€â”€ prompts/    # ä¼æ¥­åˆ¥AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
â”‚   â””â”€â”€ migrations/         # DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â””â”€â”€ docker-compose.yml      # Dockerè¨­å®š
```

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³ç´°

### PDFå‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

1. **ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: WorkOrderToolã§PDFã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
2. **å‡¦ç†**: Supabase Edge Function `process-pdf-single` ãŒå®Ÿè¡Œ
   - PDFã‚’Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
   - Gemini AI APIã§ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
   - ä¼æ¥­åˆ¥ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§æœ€é©ãªçµæœã‚’ç”Ÿæˆ
3. **ä¿å­˜**: `work_orders` ãƒ†ãƒ¼ãƒ–ãƒ«ã«çµæœã‚’æ ¼ç´
4. **è¡¨ç¤º**: GeneratedTextPanelã§ç¢ºèªãƒ»ç·¨é›†

### ãƒãƒ«ãƒã‚«ãƒ³ãƒ‘ãƒ‹ãƒ¼å¯¾å¿œ

- ä¼æ¥­IDã¯å®Ÿè¡Œæ™‚ã«å‹•çš„æ±ºå®šï¼ˆ`/public/config/active.json`ï¼‰
- Zustandã‚¹ãƒˆã‚¢ã§ä¼æ¥­ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç®¡ç†
- ä¼æ¥­åˆ¥AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªæƒ…å ±æŠ½å‡º

### èªè¨¼ãƒ•ãƒ­ãƒ¼

1. Supabase Authã§ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼
2. JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
3. ProtectedRouteã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
4. ç®¡ç†è€…ã¯ `/admin/*` ãƒ«ãƒ¼ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

## API ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

### PDFå‡¦ç†ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

**POST** `/functions/v1/process-pdf-single`

```typescript
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (FormData)
{
  file: File,           // PDFãƒ•ã‚¡ã‚¤ãƒ«
  companyId: string,    // ä¼æ¥­ID
  promptType: string    // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç¨®åˆ¥
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  generatedText: string,      // æŠ½å‡ºã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆ
  promptIdentifier: string,   // ä½¿ç”¨ã—ãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
  geminiProcessedAt: string,  // å‡¦ç†æ—¥æ™‚
  tokensUsed: number          // ä½¿ç”¨ãƒˆãƒ¼ã‚¯ãƒ³æ•°
}
```

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

### work_orders ãƒ†ãƒ¼ãƒ–ãƒ«
PDFå‡¦ç†çµæœã‚’ä¿å­˜
- `id`, `file_name`, `uploaded_at`, `company_name`
- `prompt_identifier`, `generated_text`, `edited_text`
- `status`, `error_message`, `gemini_processed_at`

### shifts ãƒ†ãƒ¼ãƒ–ãƒ«
ã‚·ãƒ•ãƒˆæƒ…å ±ã‚’ç®¡ç†
- `id`, `user_id`, `date`, `shift_type`
- `custom_end_time`, `note`

## é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

- **TypeScript**: `any`å‹ã®ä½¿ç”¨ç¦æ­¢ã€å³æ ¼ãªå‹å®šç¾©
- **ã‚³ãƒŸãƒƒãƒˆ**: æ—¥æœ¬èªã§ã®ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä¾‹: `feat: ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æ©Ÿèƒ½ã‚’è¿½åŠ `ï¼‰
- **ãƒ†ã‚¹ãƒˆ**: TDDæ¨å¥¨ã€Vitest + React Testing Library
- **ã‚³ãƒ¼ãƒ‰å“è³ª**: ESLint + Prettier ã§ã‚³ãƒ¼ãƒ‰å“è³ªã‚’ç¶­æŒ

è©³ç´°ãªé–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã¯ [CLAUDE.md](./CLAUDE.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

Â© kanatani
